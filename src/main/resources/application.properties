# ========================================
# One Agent 4J 完整配置示例
# ========================================
# 注意：以下大部分配置都是可选的！
# 引入依赖后，所有功能默认自动启用
# 必须配置：数据库连接 + AI API Key（如果使用 AI 去噪）
# 参考最小化配置：application-minimal.properties
# ========================================

spring.application.name=one-agent-4j
spring.profiles.active=dev
server.port=8080

# ========== AI 模型配置（如果使用 AI 去噪，必须配置）==========
langchain4j.open-ai.chat-model.api-key=${OPENAI_API_KEY:your-api-key-here}
langchain4j.open-ai.chat-model.base-url=${OPENAI_BASE_URL:https://api.siliconflow.cn}
langchain4j.open-ai.chat-model.model-name=${OPENAI_MODEL_NAME:deepseek-ai/DeepSeek-V3}
langchain4j.open-ai.chat-model.temperature=0.7
langchain4j.open-ai.chat-model.max-tokens=2000
langchain4j.open-ai.chat-model.timeout=60

# ========== One Agent 总开关（可选）==========
# 是否启用 One Agent（默认 true，引入依赖后自动启用）
# one-agent.enabled=true

# ========== 存储策略配置（可选）==========
# 是否启用本地持久化（默认 true）
# one-agent.storage-strategy.enable-local-persistence=true
# 是否自动生成工单（默认 true）
# one-agent.storage-strategy.enable-ticket-generation=true

# ========== 第 0 层：基础过滤配置（Ignore List - 可选）==========
# 忽略的异常类型（完整类名或简单类名，多个用逗号分隔）
one-agent.ignore-list.exception-types=AccessDeniedException,NoHandlerFoundException,HttpRequestMethodNotSupportedException
# 忽略的包前缀（多个用逗号分隔）
one-agent.ignore-list.package-prefixes=org.springframework.boot.actuate,springfox.documentation
# 忽略的错误位置（支持通配符 *，多个用逗号分隔，格式：类名.方法名 或 *.方法名）
one-agent.ignore-list.error-locations=*.health,*.heartbeat,*.ping
# 忽略包含特定关键词的异常消息（多个用逗号分隔）
one-agent.ignore-list.message-keywords=health check,heartbeat,actuator,swagger
# 忽略特定 HTTP 状态码的异常（多个用逗号分隔）
one-agent.ignore-list.http-status-codes=404,401,403

# ========== 第 1 层：指纹去重配置（可选）==========
# 时间窗口（分钟，默认 2）- 在此时间窗口内，相同指纹的异常只处理一次
# one-agent.dedup.time-window-minutes=2

# ========== 第 1.5 层：规则引擎配置（可选）==========
# 频率限制规则（防止异常风暴）
# one-agent.rule-engine.frequency-limit.enabled=true
# one-agent.rule-engine.frequency-limit.window-minutes=5
# one-agent.rule-engine.frequency-limit.max-count=10

# 时间窗口规则（非工作时间只告警高优先级）
# one-agent.rule-engine.time-window.enabled=false
# one-agent.rule-engine.time-window.quiet-hours=2-6
# one-agent.rule-engine.time-window.allowed-severities=P0

# 环境规则（不同环境不同策略）
# one-agent.rule-engine.environment.enabled=false
# one-agent.rule-engine.environment.test-filter-severities=P3,P4

# ========== HTTP 请求日志配置（可选）==========
# 慢请求阈值（毫秒，默认 3000）- 超过此值会打印 WARN 级别日志
# one-agent.http-log.slow-request-threshold=3000
# 排除的 URI 前缀（不打印日志）
one-agent.http-log.exclude-uri-prefixes=/actuator,/swagger,/v2/api-docs,/v3/api-docs
# 排除的具体 URI（精确匹配）
one-agent.http-log.exclude-uris=/favicon.ico,/health,/ping

# ========== 第 2 层：AI 智能去噪配置（可选）==========
# 是否启用 AI 去噪（默认 false）
one-agent.ai-denoise.enabled=true

# AI 去噪回看时间窗口（分钟，默认 2）
# one-agent.ai-denoise.lookback-minutes=2

# AI 决策结果缓存（默认启用）
# one-agent.ai-denoise.cache-enabled=true
# one-agent.ai-denoise.cache-ttl-minutes=5

# ========== 数据库配置 ==========
spring.datasource.url=jdbc:mysql://localhost:3306/one_agent?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
spring.datasource.username=root
spring.datasource.password=123456
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# MyBatis-Plus 配置
mybatis-plus.configuration.map-underscore-to-camel-case=true
mybatis-plus.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl
mybatis-plus.global-config.db-config.id-type=auto

# 日志配置
logging.level.root=INFO
logging.level.com.all.in.one.agent=DEBUG
